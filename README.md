# 📈 Baidu Index Spy (Tampermonkey Edition) | 百度指数数据导出神器

**Baidu Index Spy** 是一个基于 Tampermonkey (油猴) 的浏览器脚本，旨在解决百度指数（Baidu Index）数据无法直接下载、只能通过肉眼查看图表的痛点。

本项目采用**非侵入式嗅探技术**，自动拦截浏览器与百度服务器之间的通信，提取加密数据与解密秘钥，在本地（浏览器端）瞬间完成解密与清洗，并一键生成带有**真实日期时间轴**的 CSV 报表。

## ✨ 核心功能 (Features)

* **🛡️ 全自动嗅探**：无需手动 F12 抓包，脚本自动监听后台网络请求。
* **🔐 核心算法解密**：完美还原百度指数的 `uniqid` + `ptbk` 动态映射加密算法。
* **📅 智能日期重建**：
* 自动识别数据的颗粒度（日级/周级）。
* **自动补全日期**：将百度返回的纯数字序列（如 `123, 456...`）转化为带有精确日期的表格（如 `2024-01-01, 2024-01-02...`）。


* **📊 多模式支持**：
* ✅ **搜索指数** (Search Index)
* ✅ **资讯指数** (News/Feed Index)


* **🔗 批量对比**：支持同时导出多个对比关键词（如 `ChatGPT` vs `文心一言` vs `Gemini`），自动聚合为一张总表。
* **📂 Excel 友好**：导出为 UTF-8 BOM 格式的 `.csv` 文件，Excel 打开不乱码，无需二次转换。

---

## 🛠️ 技术原理 (Technical Details)

本项目并非传统的爬虫（Crawler），而是一个**中间人嗅探器（Sniffer）**。它利用 JavaScript 的原型链劫持技术，在数据到达页面渲染层之前将其捕获。

### 1. 网络层劫持 (Network Interception)

脚本重写了浏览器的 `XMLHttpRequest.prototype.open` 和 `XMLHttpRequest.prototype.send` 方法。
当用户访问百度指数页面时，脚本会在后台静默监听所有 API 请求：

* **数据接口**：监听 `/api/SearchApi/index`（搜索指数）或 `/api/FeedSearchApi/getFeedIndex`（资讯指数），捕获加密的原始数据。
* **秘钥接口**：监听 `/Interface/ptbk`，捕获对应的动态解密秘钥。

### 2. "锁"与"钥匙"机制 (Lock & Key)

百度指数的数据保护机制基于一次性会话 ID (`uniqid`)：

1. **Lock (数据)**：服务端返回的指数数据是一串杂乱的字符（如 `"t8x04Rs5mu..."`），无法直接阅读。该数据被标记了一个 `uniqid`。
2. **Key (秘钥)**：浏览器必须使用相同的 `uniqid` 请求秘钥接口，获得一把对应的“钥匙”。
3. **动态性**：`uniqid` 随每一次请求动态变化。即使是相同的关键词，刷新页面后“锁”和“钥匙”都会改变。本脚本通过**实时配对**拦截到的数据包，确保解密 100% 成功。

### 3. 解密映射算法 (Decryption Logic)

获得的秘钥（Key）是一个特定长度的字符串，解密逻辑如下：

* **分割**：将 Key 字符串从中间切分。
* 前半部分：**密文索引**
* 后半部分：**明文真值**


* **映射**：构建一个字典，将密文索引中的字符一一映射到明文真值。
* **替换**：遍历加密数据字符串，根据字典替换每一个字符，最终还原出真实的数字序列（如 `"1234, 2567..."`）。

### 4. 时间轴拟合 (Time Series Fitting)

百度 API 在长周期（如3年）下返回的是“周级”数据，不包含具体日期。
脚本内置了智能拟合算法：

* 提取元数据中的 `startDate` 和 `endDate`。
* 计算数据点的总数量 `Count`。
* 通过 `(End - Start) / Count` 自动推算采样步长（Step），从而生成精准的 `YYYY-MM-DD` 时间轴序列。

---

## 🚀 使用教程 (Usage)

### 1. 安装准备

* 确保你的浏览器（Chrome / Edge / Firefox）已安装 **Tampermonkey** 插件。
* [点击这里下载 Tampermonkey](https://www.tampermonkey.net/)

### 2. 导入脚本

1. 点击 Tampermonkey 图标 -> **添加新脚本**。
2. 将本项目中的 `baidud_index_spy.js` (或者你复制的代码) 全部粘贴到编辑器中。
3. 按 `Ctrl + S` 保存。

### 3. 开始抓取

1. 打开 [百度指数](https://index.baidu.com/) 官网。
2. 在搜索框输入关键词（支持添加对比词），点击开始探索。
3. **观察右上角**：页面右上角会出现一个悬浮面板 **“📅 百度指数导出助手”**。
* 状态显示 `⏳ 等待数据刷新...` 表示正在监听。


4. 等待图表线条加载出来，面板会自动提示：
* `✓ 🔑 秘钥已更新`
* `✓ 📊 搜索指数已捕获`


5. 按钮变蓝，点击 **“📥 导出 CSV (带日期)”** 即可下载文件。

### 4. 进阶操作

* **切换资讯指数**：直接点击网页上的“资讯指数”标签，脚本会自动捕获新数据，无需刷新页面。
* **修改时间范围**：在网页上调整时间（如“近30天”或“自定义时间”），脚本会自动更新并重新计算日期序列。

---

## ⚠️ 注意事项 (Precautions)

1. **无数据反应？**
* 如果面板一直显示“等待数据”，请尝试按 `F5` 刷新页面。必须让网页重新发起一次网络请求，脚本才能拦截到数据。


2. **账号登录**
* 使用前请确保你已经登录了百度账号，否则百度指数不会展示数据。


3. **频次控制**
* 本脚本完全复用浏览器的正常流量，**不会**额外发起请求，理论上极其安全。
* 但如果你频繁刷新页面或切换关键词（如 1秒1次），可能会触发百度的滑块验证码。手动完成验证即可恢复。



---

## ⚖️ 免责声明 (Disclaimer)

1. 本项目仅供**技术研究和学习**使用，旨在展示前端数据拦截与解密算法的实现原理。
2. 使用者**不得**将本项目用于大规模爬虫采集、商业数据售卖、破坏网站正常运行或任何侵犯百度公司权益的行为。
3. 本工具导出的数据仅代表脚本运行时刻浏览器获取的内容，作者不对数据的准确性负责。
4. 使用本项目所产生的任何法律后果由使用者自行承担。

---

**Star ⭐ this repository if it helps you!**
